<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morpheus UI</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #dbe7f0; /* Custom Color */
            font-family: Arial, sans-serif;
            overflow: hidden; /* Prevent scrollbar during swipe */
            height: 100vh; /* Ensure body takes full viewport height */
            margin: 0; /* Remove default margin */
        }
        .btn-custom {
            background-color: transparent;
            border: none;
        }
        .btn-custom:hover {
            color: orange;
        }
        .card-title {
            font-size: 20px;
            font-weight: bold;
            color: #007bff;
        }
        .card-info {
            font-size: 10px;
            color: #444;
        }
        .main-text, .warning-text {
            font-size: 12px;
            color: #555;
        }
        .warning-text {
            color: orange;
        }
        .image-section img {
            width: 100%;
            height: auto;
            max-width: 300px; /* Initial max width */
            transition: max-width 0.3s ease;
        }
        @media (min-width: 768px) {
            .card-title {
                font-size: 40px;
            }
            .card-info {
                font-size: 15px;
            }
            .main-text {
                font-size: 20px;
            }
            .image-section img {
                max-width: 400px; /* Größere max width bei größeren Bildschirmen */
            }
        }
        .alert-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 9999;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
        }
        .alert-container.active {
            display: block;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: none;
            z-index: 9998;
        }
        .overlay.active {
            display: block;
        }
        /* Loader Styles */
        .loader {
            border: 8px solid #f3f3f3; /* Light grey */
            border-top: 8px solid #007bff; /* Blue */
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10000;
            display: none;
        }
        .loader.active {
            display: block;
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        /* Arrow Buttons for PC/Notebook */
        .arrow-buttons {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 1000;
        }
        .arrow-buttons button {
            pointer-events: all;
            background-color: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 50%;
            padding: 10px;
            margin: 0 20px;
        }
        .arrow-buttons button:hover {
            background-color: rgba(255, 165, 0, 0.8); /* Orange */
        }
        @media (hover: none) and (pointer: coarse) {
            /* Hide arrow buttons on touch devices */
            .arrow-buttons {
                display: none;
            }
        }
    </style>
</head>
<body>

    <!-- Loader -->
    <div class="loader" id="loader"></div>

    <div class="container p-4" id="mainContent">
        <!-- Header Buttons -->
        <div class="d-flex justify-content-between">
            <button class="btn-custom" onclick="toggleAlert()" aria-label="Eingabe öffnen">
                <i class="bi bi-plus-circle-fill" style="font-size: 1.5rem;"></i>
            </button>
            <button class="btn-custom d-flex align-items-center" id="skipButton" onclick="skipCard()" style="display: none;" aria-label="Skip">
                <span class="me-2">Skip</span>
                <i class="bi bi-play-circle-fill" style="font-size: 1.5rem; color: orange;"></i>
            </button>
        </div>

        <!-- Card Content -->
        <div class="mt-4">
            <h1 class="card-title" id="cardTitle">Titel Lorem ipsum dolor sit amet</h1>
            <p class="card-info" id="cardInfo">CARD: 001 / 100</p>
        </div>

        <div class="row mt-3">
            <div class="col-md-8">
                <p class="main-text" id="mainText">
                    Main Text ....Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse est leo, vehicula eu eleifend non, auctor ut arcu...
                </p>
                <p class="warning-text" id="warningText">
                    Warning Text ....Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse est leo, vehicula eu eleifend non, auctor ut arcu...
                </p>
            </div>
            <div class="col-md-4 image-section text-center">
                <img src="https://via.placeholder.com/300" alt="Placeholder Image" id="mediaImage">
            </div>
        </div>
    </div>

    <!-- Arrow Buttons for PC/Notebook -->
    <div class="arrow-buttons">
        <button onclick="previousCard()" aria-label="Vorherige Karte">
            <i class="bi bi-arrow-left-circle-fill" style="font-size: 2rem;"></i>
        </button>
        <button onclick="nextCard()" aria-label="Nächste Karte">
            <i class="bi bi-arrow-right-circle-fill" style="font-size: 2rem;"></i>
        </button>
    </div>

    <!-- Alert Modal -->
    <div class="alert-container" id="alertContainer">
        <h4 class="text-center">Eingabe</h4>
        <input type="text" id="inputText" maxlength="4" class="form-control mt-3" placeholder="Max 4 Zeichen" aria-label="4-Zeichen-Code">
        <div class="d-flex justify-content-between mt-4">
            <button class="btn btn-danger w-50 me-1" onclick="toggleAlert()">Close</button>
            <button class="btn btn-primary w-50 ms-1" onclick="loadData()">Load</button>
        </div>
    </div>
    <div class="overlay" id="overlay"></div>

    <!-- JavaScript -->
    <script>
        let currentCardIndex = 0;
        let jsonData = [];
        let totalCards = 0;

        // Loader Control
        function showLoader() {
            document.getElementById('loader').classList.add('active');
        }

        function hideLoader() {
            document.getElementById('loader').classList.remove('active');
        }

        // Toggle Alert Modal
        function toggleAlert() {
            const alertContainer = document.getElementById('alertContainer');
            const overlay = document.getElementById('overlay');
            alertContainer.classList.toggle('active');
            overlay.classList.toggle('active');
            if (!alertContainer.classList.contains('active')) {
                document.getElementById('inputText').value = '';
            }
        }

        // Load Data Function
        async function loadData() {
            const input = document.getElementById('inputText').value.trim();
            console.log(`Eingabe: ${input}`);
            if (input.length === 4) {
                showLoader();
                try {
                    // Fetch JSON file based on input
                    const response = await fetch(`data/${input}.json`);
                    console.log(`Fetching: data/${input}.json`);
                    if (!response.ok) {
                        throw new Error('Datei nicht gefunden');
                    }
                    jsonData = await response.json();
                    console.log('JSON-Daten geladen:', jsonData);
                    if (!Array.isArray(jsonData) || jsonData.length === 0) {
                        throw new Error('Keine Daten gefunden');
                    }
                    currentCardIndex = 0;
                    totalCards = jsonData.length;
                    updateUI(jsonData[currentCardIndex]);
                    toggleAlert();
                } catch (error) {
                    console.error(error);
                    alert(`Fehler: ${error.message}`);
                } finally {
                    hideLoader();
                }
            } else {
                alert('Bitte genau 4 Zeichen eingeben.');
            }
        }

        // Update UI Function
        function updateUI(card) {
            console.log('Aktuelle Karte:', card);
            // Validierung der Daten
            if (!card.CardNumber || !card.Titel || !card.Maintext || !card.Warning || !card.Media) {
                alert('Unvollständige Daten in der JSON-Datei.');
                return;
            }
            // Aktualisiere die UI-Elemente
            document.getElementById('cardTitle').textContent = card.Titel;
            document.getElementById('cardInfo').textContent = `CARD: ${String(card.CardNumber).padStart(3, '0')} / ${totalCards}`;
            document.getElementById('mainText').textContent = `${card.Maintext}`;
            document.getElementById('warningText').textContent = `${card.Warning}`;

            const mediaImage = document.getElementById('mediaImage');
            if (card.Media && card.Media.toLowerCase() !== 'none') {
                mediaImage.src = `media/${card.Media}`;
                mediaImage.alt = `Media ${card.Media}`;
            } else {
                mediaImage.src = 'https://via.placeholder.com/300?text=No+Image';
                mediaImage.alt = 'No Image';
            }

            // Bildfehler abfangen
            mediaImage.onerror = function() {
                this.src = 'https://via.placeholder.com/300?text=No+Image';
                this.alt = 'No Image';
            }

            // Handle Skip Button
            const skipButton = document.getElementById('skipButton');
            if (String(card.SwitchOn) === "1") {
                skipButton.style.display = 'flex';  // Skip Button anzeigen

                if (card.SelectedCard !== "none" && !isNaN(card.SelectedCard)) {
                    skipButton.onclick = () => skipCard(card.SelectedCard);  // Gehe zu ausgewählter Karte
                } else {
                    skipButton.onclick = () => skipCard();  // Standardmäßig zur nächsten Karte gehen
                }
            } else {
                skipButton.style.display = 'none';  // Skip Button ausblenden
            }
        }

        // Skip Card Function
        function skipCard(selectedCard = null) {
            if (selectedCard) {
                const targetIndex = jsonData.findIndex(c => String(c.CardNumber) === String(selectedCard));
                console.log(`SelectedCard: ${selectedCard}, TargetIndex: ${targetIndex}`);
                if (targetIndex !== -1) {
                    currentCardIndex = targetIndex;
                    updateUI(jsonData[currentCardIndex]);
                } else {
                    alert('Ausgewählte Karte existiert nicht.');
                }
            } else {
                // Skip logic: Go to next card
                nextCard();
            }
        }

        // Swipe Gesture Handling
        let touchStartX = 0;
        let touchEndX = 0;

        function handleGesture() {
            const swipeThreshold = 50; // Minimum distance for swipe
            if (touchEndX < touchStartX - swipeThreshold) {
                // Swipe Left
                nextCard();
            }
            if (touchEndX > touchStartX + swipeThreshold) {
                // Swipe Right
                previousCard();
            }
        }

        function nextCard() {
            if (jsonData.length > 0) {
                currentCardIndex = (currentCardIndex + 1) % jsonData.length;
                updateUI(jsonData[currentCardIndex]);
            }
        }

        function previousCard() {
            if (jsonData.length > 0) {
                currentCardIndex = (currentCardIndex - 1 + jsonData.length) % jsonData.length;
                updateUI(jsonData[currentCardIndex]);
            }
        }

        // Add touch event listeners to the entire document
        document.addEventListener('touchstart', function(event) {
            touchStartX = event.changedTouches[0].screenX;
        }, false);

        document.addEventListener('touchend', function(event) {
            touchEndX = event.changedTouches[0].screenX;
            handleGesture();
        }, false);

        // Keyboard Arrow Keys Handling
        document.addEventListener('keydown', function(event) {
            if (jsonData.length === 0) return; // Keine Karten geladen
            switch(event.key) {
                case 'ArrowLeft':
                    previousCard();
                    break;
                case 'ArrowRight':
                    nextCard();
                    break;
                default:
                    break;
            }
        });

        // Initial UI setup (optional)
        window.onload = function() {
            // Optional: Lade eine Standardkarte oder lasse die UI unverändert
        }
    </script>

</body>
</html>
